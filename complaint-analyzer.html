<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π –∞–Ω–∞–ª—ñ–∑–∞—Ç–æ—Ä —Å–∫–∞—Ä–≥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Harmony (Neutral Slate/Gray with Indigo accent) -->
    <!-- Application Structure Plan: A task-oriented single-page dashboard. The user enters complaint data into a form, which triggers an analysis. The results are displayed in a modular dashboard with sections for the complainant's profile, internal case history, external intelligence findings, and a final, clear recommendation. This structure guides the user from data input to actionable insight logically and without clutter. -->
    <!-- Visualization & Content Choices: Report Info: Complainant details, TM, Product Name, ASIN. Goal: Analyze risk and provide action. Viz/Method: No charts needed; the data is qualitative. The app uses structured HTML/Tailwind cards to present information. Key elements are: an input form with a new Product Name field, a results dashboard with modules for internal history (HTML list), external findings (HTML list with icons), and a prominent recommendation card. Interaction: User submits form, JS processes mock data, and dynamically updates the DOM to show the analysis. Justification: This approach is direct, task-focused, and presents complex information clearly without the need for abstract charts. The added Product Name field makes the mock analysis more realistic. Library/Method: Vanilla JS and Tailwind CSS. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .form-input {
            transition: all 0.3s ease;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 md:p-8 max-w-6xl">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">–ê–Ω–∞–ª—ñ–∑–∞—Ç–æ—Ä —Å–∫–∞—Ä–≥ Amazon</h1>
            <p class="text-slate-600 mt-2">–í–≤–µ–¥—ñ—Ç—å –¥–∞–Ω—ñ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É —Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π.</p>
        </header>

        <main>
            <div id="form-section" class="card p-6 md:p-8 mb-8">
                <form id="complaint-form">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="complainant-name" class="block text-sm font-medium text-slate-700 mb-1">–Ü–º'—è —Å–∫–∞—Ä–∂–Ω–∏–∫–∞</label>
                            <input type="text" id="complainant-name" name="complainant-name" class="form-input block w-full border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="BrandShield Corp." required>
                        </div>
                        <div>
                            <label for="complainant-email" class="block text-sm font-medium text-slate-700 mb-1">–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞ —Å–∫–∞—Ä–∂–Ω–∏–∫–∞</label>
                            <input type="email" id="complainant-email" name="complainant-email" class="form-input block w-full border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="legal@brandshield.com" required>
                        </div>
                        <div>
                            <label for="trademark" class="block text-sm font-medium text-slate-700 mb-1">–¢–æ—Ä–≥–æ–≤–µ–ª—å–Ω–∞ –º–∞—Ä–∫–∞ (–¢–ú)</label>
                            <input type="text" id="trademark" name="trademark" class="form-input block w-full border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="US987654321" required>
                        </div>
                        <div>
                            <label for="product-name" class="block text-sm font-medium text-slate-700 mb-1">–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É</label>
                            <input type="text" id="product-name" name="product-name" class="form-input block w-full border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="Smartphone Case" required>
                        </div>
                        <div>
                            <label for="product-asin" class="block text-sm font-medium text-slate-700 mb-1">–¢–æ–≤–∞—Ä (ASIN)</label>
                            <input type="text" id="product-asin" name="product-asin" class="form-input block w-full border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="B08N5WRWNW" required>
                        </div>
                    </div>
                    <div class="mt-8 text-center">
                        <button type="submit" class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105">
                            –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å–∫–∞—Ä–≥—É
                        </button>
                    </div>
                </form>
            </div>

            <div id="loading-section" class="hidden text-center py-12">
                <div class="loader mx-auto"></div>
                <p class="mt-4 text-slate-600 font-medium">–ê–Ω–∞–ª—ñ–∑—É—î–º–æ –¥–∞–Ω—ñ... –¶–µ –º–æ–∂–µ –∑–∞–π–Ω—è—Ç–∏ –∫—ñ–ª—å–∫–∞ —Å–µ–∫—É–Ω–¥.</p>
            </div>

            <div id="results-section" class="hidden">
                <div class="text-center mb-8">
                     <h2 class="text-2xl md:text-3xl font-bold text-slate-900">–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑—É</h2>
                     <p class="text-slate-600 mt-1">–ó–≤–µ–¥–µ–Ω–∏–π –∑–≤—ñ—Ç –ø–æ —Å–∫–∞—Ä–∂–Ω–∏–∫—É <span id="result-complainant-name" class="font-semibold"></span></p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    
                    <div id="recommendation-card" class="lg:col-span-3 card p-6 bg-indigo-50 border-2 border-indigo-200">
                        <h3 class="text-xl font-bold text-indigo-900 flex items-center">
                            <span class="mr-3 text-2xl">üí°</span> –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ –¥—ñ—è
                        </h3>
                        <p id="recommendation-text" class="mt-3 text-lg text-indigo-800"></p>
                    </div>
                    
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold text-slate-900 mb-4">–ü—Ä–æ—Ñ—ñ–ª—å —Å–∫–∞—Ä–∂–Ω–∏–∫–∞</h3>
                        <div id="complainant-profile" class="space-y-3 text-sm"></div>
                    </div>

                    <div class="card p-6">
                        <h3 class="text-lg font-semibold text-slate-900 mb-4">–í–Ω—É—Ç—Ä—ñ—à–Ω—è —ñ—Å—Ç–æ—Ä—ñ—è ("–ü–∞–º'—è—Ç—å")</h3>
                        <p class="text-sm text-slate-600 mb-4">–¶–µ–π —Ä–æ–∑–¥—ñ–ª –ø–æ–∫–∞–∑—É—î –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ —Ü–∏–º —Å–∫–∞—Ä–∂–Ω–∏–∫–æ–º, —â–æ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É –≤–∞—à—ñ–π —Å–∏—Å—Ç–µ–º—ñ.</p>
                        <div id="internal-history" class="space-y-4"></div>
                    </div>

                    <div class="card p-6">
                        <h3 class="text-lg font-semibold text-slate-900 mb-4">–ó–æ–≤–Ω—ñ—à–Ω—ñ–π –ø–æ—à—É–∫ (–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç)</h3>
                         <p class="text-sm text-slate-600 mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Å–∏–º—É–ª—è—Ü—ñ—ó –ø–æ—à—É–∫—É —É –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –¥–∂–µ—Ä–µ–ª–∞—Ö –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–∞–Ω–∏—Ö —Ç–∞ —Ä–µ–ø—É—Ç–∞—Ü—ñ—ó.</p>
                        <div id="external-search" class="space-y-3"></div>
                    </div>
                </div>

                <div class="mt-8 text-center">
                    <button id="draft-email-button" class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105">
                         ‚ú® –°—Ç–≤–æ—Ä–∏—Ç–∏ –¥—Ä–∞—Ñ—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
                    </button>
                    <div id="email-draft-container" class="mt-6 hidden">
                        <h4 class="text-lg font-semibold text-slate-900 mb-3">–î—Ä–∞—Ñ—Ç –ª–∏—Å—Ç–∞ –¥–æ —Å–∫–∞—Ä–∂–Ω–∏–∫–∞</h4>
                        <textarea id="email-draft-text" class="w-full h-72 p-4 text-sm bg-slate-100 rounded-md border border-slate-300 resize-none focus:outline-none focus:border-indigo-500" readonly></textarea>
                    </div>
                    <div id="email-draft-loader" class="hidden text-center mt-6">
                        <div class="loader mx-auto"></div>
                        <p class="mt-4 text-slate-600 font-medium">–ì–µ–Ω–µ—Ä—É—î–º–æ –¥—Ä–∞—Ñ—Ç –ª–∏—Å—Ç–∞...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const mockDatabase = {
            'legal@brandshield.com': {
                name: 'BrandShield Corp.',
                classification: '–ê–≥—Ä–µ—Å–∏–≤–Ω–∏–π, –∞–ª–µ —Å—Ö–∏–ª—å–Ω–∏–π –¥–æ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ñ–≤',
                history: [
                    { date: '2024-11-15', tm: 'US987654321', product_name: 'Smart Lock', product_asin: 'B07VGRJDFY', outcome: '–°–∫–∞—Ä–≥—É –≤—ñ–¥–∫–ª–∏–∫–∞–Ω–æ –ø—ñ—Å–ª—è –ø—Ä—è–º–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç—É.' },
                    { date: '2025-03-02', tm: 'US987654321', product_name: 'Outdoor Camera', product_asin: 'B08H9B84P3', outcome: '–ê–ø–µ–ª—è—Ü—ñ—é –∑–∞–¥–æ–≤–æ–ª–µ–Ω–æ, –Ω–∞–¥–∞–Ω–æ —Ä–∞—Ö—É–Ω–∫–∏-—Ñ–∞–∫—Ç—É—Ä–∏.' },
                ],
                external_intel: {
                    tm_validity: { status: 'valid', text: '–¢–ú –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ –≤ —Ä–µ—î—Å—Ç—Ä—ñ USPTO, –¥—ñ–π—Å–Ω–∞ –¥–æ 2028 —Ä–æ–∫—É.' },
                    reputation: { status: 'neutral', text: '–ö–æ–º–ø–∞–Ω—ñ—è –∞–∫—Ç–∏–≤–Ω–æ –∑–∞—Ö–∏—â–∞—î —Å–≤–æ—ó –¢–ú, –∞–ª–µ –Ω–µ –ø–æ–º—ñ—á–µ–Ω–∞ –≤ "–ø–∞—Ç–µ–Ω—Ç–Ω–æ–º—É —Ç—Ä–æ–ª—ñ–Ω–≥—É".' },
                    relation_to_product: { status: 'clear', text: '–Ñ –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–º –≤–∏—Ä–æ–±–Ω–∏–∫–æ–º —Ç–æ–≤–∞—Ä—É.' }
                }
            },
            'claims@patentguard.net': {
                name: 'PatentGuard LLC',
                classification: '–ü–∞—Ç–µ–Ω—Ç–Ω–∏–π —Ç—Ä–æ–ª—å',
                history: [
                    { date: '2025-01-20', tm: 'US112233445', product_name: 'Universal USB Cable', product_asin: 'B09B3V8ECV', outcome: '–ê–ø–µ–ª—è—Ü—ñ—é –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ, —Å–∫–∞—Ä–≥–∞ –Ω–µ –æ–±“ë—Ä—É–Ω—Ç–æ–≤–∞–Ω–∞.' },
                ],
                external_intel: {
                    tm_validity: { status: 'invalid', text: '–¢–ú –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ –ø—É–±–ª—ñ—á–Ω–∏—Ö —Ä–µ—î—Å—Ç—Ä–∞—Ö –∑–∞ –≤–∫–∞–∑–∞–Ω–∏–º –Ω–æ–º–µ—Ä–æ–º.' },
                    reputation: { status: 'negative', text: '–ó–Ω–∞–π–¥–µ–Ω–æ –∑–≥–∞–¥–∫–∏ –Ω–∞ —Ñ–æ—Ä—É–º–∞—Ö –ø—Ä–æ –Ω–µ–æ–±“ë—Ä—É–Ω—Ç–æ–≤–∞–Ω—ñ —Å–∫–∞—Ä–≥–∏ –≤—ñ–¥ —Ü—ñ—î—ó –∫–æ–º–ø–∞–Ω—ñ—ó.' },
                    relation_to_product: { status: 'unclear', text: '–ó–≤\'—è–∑–æ–∫ –∑ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ–º —Ç–æ–≤–∞—Ä—É –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.' }
                }
            }
        };

        const form = document.getElementById('complaint-form');
        const formSection = document.getElementById('form-section');
        const loadingSection = document.getElementById('loading-section');
        const resultsSection = document.getElementById('results-section');
        const draftEmailButton = document.getElementById('draft-email-button');
        const emailDraftContainer = document.getElementById('email-draft-container');
        const emailDraftLoader = document.getElementById('email-draft-loader');
        
        let currentComplaintData = null;

        form.addEventListener('submit', function(event) {
            event.preventDefault();
            
            const formData = new FormData(form);
            const complainantEmail = formData.get('complainant-email');
            const complainantName = formData.get('complainant-name');
            const trademark = formData.get('trademark');
            const productName = formData.get('product-name');
            const productAsin = formData.get('product-asin');

            resultsSection.classList.add('hidden');
            loadingSection.classList.remove('hidden');

            setTimeout(() => {
                const mockData = mockDatabase[complainantEmail] || generateNewComplainantData(complainantName, trademark, productName, productAsin);
                currentComplaintData = {
                    ...mockData,
                    complainantEmail,
                    complainantName,
                    trademark,
                    productName,
                    productAsin
                };

                displayResults(currentComplaintData);
                
                loadingSection.classList.add('hidden');
                resultsSection.classList.remove('hidden');
                window.scrollTo({ top: formSection.offsetHeight, behavior: 'smooth' });
                
                generateRecommendation(currentComplaintData);

            }, 2000);
        });
        
        draftEmailButton.addEventListener('click', function() {
            if (currentComplaintData) {
                generateEmailDraft(currentComplaintData);
            }
        });

        function generateNewComplainantData(name, tm, productName, asin) {
            return {
                name: name,
                classification: '–ù–æ–≤–∏–π —Å–∫–∞—Ä–∂–Ω–∏–∫',
                history: [],
                external_intel: {
                    tm_validity: { status: 'neutral', text: '–ü–æ—Ç—Ä–µ–±—É—î —Ä—É—á–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤ —Ä–µ—î—Å—Ç—Ä–∞—Ö.' },
                    reputation: { status: 'neutral', text: '–ü—É–±–ª—ñ—á–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —Å–∫–∞—Ä–≥–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.' },
                    relation_to_product: { status: 'unclear', text: `–ó–≤'—è–∑–æ–∫ –∑ —Ç–æ–≤–∞—Ä–æ–º '${productName}' –ø–æ—Ç—Ä–µ–±—É—î –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É.` }
                }
            };
        }

        async function generateRecommendation(data) {
            document.getElementById('recommendation-text').textContent = '–ì–µ–Ω–µ—Ä—É—î–º–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—é...';
            
            const prompt = `–í–∏ ‚Äî –µ–∫—Å–ø–µ—Ä—Ç-—é—Ä–∏—Å—Ç –∑ –∫–æ–º–ø–ª–∞—î–Ω—Å—É –Ω–∞ Amazon. –ù–∞ –æ—Å–Ω–æ–≤—ñ –∞–Ω–∞–ª—ñ–∑—É —Å–∫–∞—Ä–≥–∏, –Ω–∞–¥–∞–π—Ç–µ —á—ñ—Ç–∫—É, —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—É —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—é —â–æ–¥–æ –ø–æ–¥–∞–ª—å—à–∏—Ö –¥—ñ–π. –î–∞–Ω—ñ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É:
            –°–∫–∞—Ä–∂–Ω–∏–∫: ${data.name}
            –ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞: ${data.complainantEmail}
            –¢–ú: ${data.trademark}
            –¢–æ–≤–∞—Ä: ${data.productName} (${data.productAsin})
            –ö–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è: ${data.classification}
            –Ü—Å—Ç–æ—Ä—ñ—è —Å–∫–∞—Ä–≥: ${data.history.length > 0 ? data.history.map(h => `${h.outcome} (${h.date})`).join('; ') : '–ù–µ–º–∞—î –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó —ñ—Å—Ç–æ—Ä—ñ—ó.'}
            –ó–æ–≤–Ω—ñ—à–Ω—ñ–π –∞–Ω–∞–ª—ñ–∑: –í–∞–ª—ñ–¥–Ω—ñ—Å—Ç—å –¢–ú - ${data.external_intel.tm_validity.text}. –†–µ–ø—É—Ç–∞—Ü—ñ—è - ${data.external_intel.reputation.text}. –ó–≤'—è–∑–æ–∫ –∑ —Ç–æ–≤–∞—Ä–æ–º - ${data.external_intel.relation_to_product.text}.
            –°—Ñ–æ—Ä–º—É–ª—é–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—é –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —É—Å—ñ—Ö —Ñ–∞–∫—Ç–æ—Ä—ñ–≤, —â–æ–± –º–∏ –º–æ–≥–ª–∏ —à–≤–∏–¥–∫–æ –≤–∏—Ä—ñ—à–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É.`;
            
            try {
                const responseText = await callGeminiAPI(prompt);
                document.getElementById('recommendation-text').textContent = responseText;
            } catch (error) {
                console.error('Error generating recommendation:', error);
                document.getElementById('recommendation-text').textContent = '–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—é. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.';
            }
        }
        
        async function generateEmailDraft(data) {
            emailDraftContainer.classList.add('hidden');
            emailDraftLoader.classList.remove('hidden');

            const prompt = `–í–∏ ‚Äî —é—Ä–∏—Å—Ç. –°—Ç–≤–æ—Ä—ñ—Ç—å –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π, –∞–ª–µ –≤–≤—ñ—á–ª–∏–≤–∏–π –¥—Ä–∞—Ñ—Ç –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ –¥–æ —Å–∫–∞—Ä–∂–Ω–∏–∫–∞ Amazon. –ú–µ—Ç–∞ ‚Äî –≤–∏—Ä—ñ—à–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É –∑ –ø–æ—Ä—É—à–µ–Ω–Ω—è–º –¢–ú, —è–∫–µ —Å–∫–∞—Ä–∂–Ω–∏–∫ —ñ–Ω—ñ—Ü—ñ—é–≤–∞–≤ –ø—Ä–æ—Ç–∏ –Ω–∞—à–æ–≥–æ —Ç–æ–≤–∞—Ä—É. –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è –ª–∏—Å—Ç–∞:
            –Ü–º'—è —Å–∫–∞—Ä–∂–Ω–∏–∫–∞: ${data.name}
            –ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞ —Å–∫–∞—Ä–∂–Ω–∏–∫–∞: ${data.complainantEmail}
            –ù–∞—à–∞ –∫–æ–º–ø–∞–Ω—ñ—è: (–º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ '–ü—Ä–æ–¥–∞–≤–µ—Ü—å –Ω–∞ Amazon')
            –ù–æ–º–µ—Ä –¢–ú: ${data.trademark}
            –ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É: ${data.productName}
            ASIN –Ω–∞—à–æ–≥–æ —Ç–æ–≤–∞—Ä—É: ${data.productAsin}
            –£ –ª–∏—Å—Ç—ñ:
            - –ü–æ—á–Ω—ñ—Ç—å –∑ –≤–≤—ñ—á–ª–∏–≤–æ–≥–æ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è.
            - –ó–≥–∞–¥–∞–π—Ç–µ –ø—Ä–æ –æ—Ç—Ä–∏–º–∞–Ω—É —Å–∫–∞—Ä–≥—É —Ç–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É–π—Ç–µ —Ç–æ–≤–∞—Ä —Ç–∞ –¢–ú.
            - –ó–∞–ø—Ä–æ–ø–æ–Ω—É–π—Ç–µ –æ–±–≥–æ–≤–æ—Ä–∏—Ç–∏ —Å–∏—Ç—É–∞—Ü—ñ—é, —â–æ–± –∑–Ω–∞–π—Ç–∏ –≤–∏—Ä—ñ—à–µ–Ω–Ω—è.
            - –ó–∞–ø—Ä–æ—Å—ñ—Ç—å —Å–∫–∞—Ä–∂–Ω–∏–∫–∞ –≤—ñ–¥–∫–ª–∏–∫–∞—Ç–∏ —Å–∫–∞—Ä–≥—É –ø—ñ—Å–ª—è —É–∑–≥–æ–¥–∂–µ–Ω–Ω—è.
            - –ó–∞–≤–µ—Ä—à—ñ—Ç—å –ª–∏—Å—Ç –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–º –ø—ñ–¥–ø–∏—Å–æ–º.
            –°—Ç–≤–æ—Ä—ñ—Ç—å –ª–∏—à–µ —Ç–µ–∫—Å—Ç –ª–∏—Å—Ç–∞, –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫—É –º–æ–≤—É.`;
            
            try {
                const responseText = await callGeminiAPI(prompt);
                document.getElementById('email-draft-text').value = responseText;
            } catch (error) {
                console.error('Error generating email draft:', error);
                document.getElementById('email-draft-text').value = '–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –¥—Ä–∞—Ñ—Ç –ª–∏—Å—Ç–∞. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.';
            } finally {
                emailDraftLoader.classList.add('hidden');
                emailDraftContainer.classList.remove('hidden');
            }
        }
        
        async function callGeminiAPI(prompt) {
            const apiKey = "";
            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            let response = null;
            let result = null;
            let retryCount = 0;
            const maxRetries = 5;
            const delay = 1000;

            while (retryCount < maxRetries) {
                try {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (response.status === 429) {
                        retryCount++;
                        await new Promise(res => setTimeout(res, delay * Math.pow(2, retryCount)));
                        continue;
                    }

                    result = await response.json();
                    break;
                } catch (error) {
                    console.error('Fetch error:', error);
                    throw error;
                }
            }
            
            if (result && result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                return result.candidates[0].content.parts[0].text;
            } else {
                throw new Error('Unexpected API response structure or content missing.');
            }
        }

        function displayResults(data) {
            document.getElementById('result-complainant-name').textContent = data.complainantName;
            
            const profileContainer = document.getElementById('complainant-profile');
            profileContainer.innerHTML = `
                <p><span class="font-semibold text-slate-600">–Ü–º'—è:</span> ${data.complainantName}</p>
                <p><span class="font-semibold text-slate-600">Email:</span> ${data.complainantEmail}</p>
                <p><span class="font-semibold text-slate-600">–ó–∞—è–≤–ª–µ–Ω–∞ –¢–ú:</span> ${data.trademark}</p>
                <p><span class="font-semibold text-slate-600">–¢–æ–≤–∞—Ä:</span> ${data.productName}</p>
                <p><span class="font-semibold text-slate-600">–¢–æ–≤–∞—Ä (ASIN):</span> ${data.productAsin}</p>
                <div class="mt-3 pt-3 border-t">
                    <p class="font-semibold text-slate-600">–ö–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è:</p>
                    <span class="inline-block px-3 py-1 text-sm font-semibold rounded-full ${getBadgeColor(data.classification)}">
                        ${data.classification}
                    </span>
                </div>
            `;

            const historyContainer = document.getElementById('internal-history');
            if (data.history.length > 0) {
                historyContainer.innerHTML = data.history.map(item => `
                    <div class="p-3 bg-slate-50 rounded-md border border-slate-200">
                        <p class="font-semibold text-sm">${item.date} - ${item.product_name}</p>
                        <p class="text-xs text-slate-600 mt-1">${item.outcome}</p>
                    </div>
                `).join('');
            } else {
                historyContainer.innerHTML = '<p class="text-sm text-slate-500">–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö —Å–∫–∞—Ä–≥ –≤—ñ–¥ —Ü—å–æ–≥–æ —Å–∫–∞—Ä–∂–Ω–∏–∫–∞ —É –±–∞–∑—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</p>';
            }

            const externalContainer = document.getElementById('external-search');
            const intel = data.external_intel;
            externalContainer.innerHTML = `
                <div class="flex items-start">
                    <span class="mr-3 mt-1">${getIcon(intel.tm_validity.status)}</span>
                    <div>
                        <p class="font-semibold text-sm">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¢–ú</p>
                        <p class="text-xs text-slate-600">${intel.tm_validity.text}</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <span class="mr-3 mt-1">${getIcon(intel.reputation.status)}</span>
                    <div>
                        <p class="font-semibold text-sm">–†–µ–ø—É—Ç–∞—Ü—ñ—è</p>
                        <p class="text-xs text-slate-600">${intel.reputation.text}</p>
                    </div>
                </div>
                 <div class="flex items-start">
                    <span class="mr-3 mt-1">${getIcon(intel.relation_to_product.status)}</span>
                    <div>
                        <p class="font-semibold text-sm">–ó–≤'—è–∑–æ–∫ –∑ —Ç–æ–≤–∞—Ä–æ–º</p>
                        <p class="text-xs text-slate-600">${intel.relation_to_product.text}</p>
                    </div>
                </div>
            `;
            
            document.getElementById('recommendation-text').textContent = '';
            document.getElementById('email-draft-text').value = '';
            emailDraftContainer.classList.add('hidden');
        }

        function getBadgeColor(classification) {
            if (classification.includes('–ê–≥—Ä–µ—Å–∏–≤–Ω–∏–π')) return 'bg-yellow-100 text-yellow-800';
            if (classification.includes('—Ç—Ä–æ–ª—å')) return 'bg-red-100 text-red-800';
            if (classification.includes('–ù–æ–≤–∏–π')) return 'bg-blue-100 text-blue-800';
            return 'bg-slate-100 text-slate-800';
        }

        function getIcon(status) {
            if (status === 'valid' || status === 'clear') return '<span class="text-green-500 text-lg">‚úî</span>';
            if (status === 'invalid' || status === 'negative') return '<span class="text-red-500 text-lg">‚úñ</span>';
            return '<span class="text-slate-400 text-lg">?</span>';
        }
    </script>

</body>
</html>
